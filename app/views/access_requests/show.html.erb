<div class="access-request-header">
  <h1>Access Request Details</h1>
  <div class="actions">
    <% if @access_request.active? %>
      <%= link_to "Edit", edit_access_request_path(@access_request), class: "btn btn-primary" %>
      <%= link_to "Resend Link", resend_access_request_path(@access_request), 
          method: :patch, 
          confirm: "This will generate a new access link. Are you sure?",
          class: "btn btn-secondary" %>
      <%= link_to "Cancel", cancel_access_request_path(@access_request), 
          method: :patch, 
          confirm: "Are you sure you want to cancel this request?",
          class: "btn btn-danger" %>
    <% end %>
    <%= link_to "View Access Grants", access_grants_path, class: "btn btn-outline-success" %>
    <%= link_to "Back to Requests", access_requests_path, class: "btn btn-outline-secondary" %>
  </div>
</div>

<div class="access-request-details">
  <div class="detail-section">
    <h3>Request Information</h3>
    <dl class="detail-list">
      <dt>Client:</dt>
      <dd><%= @access_request.client.display_name %></dd>
      
      <dt>Template:</dt>
      <dd><%= @access_request.access_template.name %></dd>
      
      <dt>Status:</dt>
      <dd>
        <span class="status-badge status-<%= @access_request.status %>">
          <%= @access_request.status.humanize %>
        </span>
      </dd>
      
      <dt>Created:</dt>
      <dd><%= @access_request.created_at.strftime('%Y-%m-%d %H:%M') %></dd>
      
      <dt>Expires:</dt>
      <dd><%= @access_request.expires_at.strftime('%Y-%m-%d %H:%M') %></dd>
      
      <dt>Token:</dt>
      <dd><code><%= @access_request.token %></code></dd>
    </dl>
  </div>

  <div class="detail-section">
    <h3>Access Link</h3>
    <div class="access-link">
      <label for="access-link">Share this link with the client:</label>
      <div class="link-container">
        <input type="text" 
               id="access-link" 
               value="<%= links_access_request_url(@access_request.token) %>" 
               readonly 
               class="form-control">
        <button type="button" 
                onclick="copyToClipboard('access-link')" 
                class="btn btn-outline-primary">
          Copy Link
        </button>
      </div>
    </div>
  </div>

  <% if @access_grants.any? %>
    <div class="detail-section">
      <h3>Access Grants</h3>
      <table class="table">
        <thead>
          <tr>
            <th>Provider</th>
            <th>Status</th>
            <th>Granted At</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <% @access_grants.each do |grant| %>
            <tr>
              <td><%= grant.integration_provider.display_name %></td>
              <td>
                <span class="status-badge status-<%= grant.status %>">
                  <%= grant.status.humanize %>
                </span>
              </td>
              <td>
                <% if grant.created_at %>
                  <%= grant.created_at.strftime('%Y-%m-%d %H:%M') %>
                <% else %>
                  <em>Not granted</em>
                <% end %>
              </td>
              <td>
                <%= link_to "View", access_grant_path(grant), class: "btn btn-sm btn-outline-primary" %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  <% end %>
</div>

<script>
function copyToClipboard(elementId) {
  const element = document.getElementById(elementId);
  element.select();
  element.setSelectionRange(0, 99999); // For mobile devices
  document.execCommand('copy');
  
  // Show feedback
  const button = element.nextElementSibling;
  const originalText = button.textContent;
  button.textContent = 'Copied!';
  button.classList.add('btn-success');
  button.classList.remove('btn-outline-primary');
  
  setTimeout(() => {
    button.textContent = originalText;
    button.classList.remove('btn-success');
    button.classList.add('btn-outline-primary');
  }, 2000);
}
</script>
